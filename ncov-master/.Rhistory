setwd("/Users/ijborda/GitHub/gisaid-preprocessing/ncov-master")
wd = getwd()
id = paste0(wd,"/output/")
od = paste0(wd,"/output/")
ref = paste0(wd,"/reference/")
##Load libraries
require(pacman)
p_load(EpiCurve,dplyr,tidyr,pacman, ggplot2,ggthemes,broom,stringr,ggpubr,scales,lubridate)
filename <- "211102.bdmm"
metadata <- read.delim(file = (paste0(id,filename,".metadata.sanitized.clean.tsv")) , sep = '\t', header = TRUE)
metadata$date <- as.Date(metadata$date, format="%Y-%m-%d")
variants <- read.delim(file = (paste0(ref,"variants.csv")) , sep = ',', header = TRUE)
#Clean region names
metadata$division <- ifelse(grepl("Davao Region", metadata$division),'Davao', metadata$division)
metadata$division <- ifelse(grepl("Bangsamoro Autonomous Region in Muslim Mindanao", metadata$division),'BARMM', metadata$division)
metadata$division <- ifelse(grepl("Region IX", metadata$division),'Zamboanga', metadata$division)
metadata$division <- ifelse(grepl("National Capital Region", metadata$division),'NCR', metadata$division)
#Make column for VOC
metadata$voc = metadata$pangolin_lineage
metadata['voc'] = "Non VOC"
for(i in 1:nrow(variants)){
metadata$voc <- ifelse(grepl(as.character(paste0("^",variants[i,1],"$")), metadata$pangolin_lineage),as.character(variants[i,2]), metadata$voc)
}
View(metadata)
View(metadata)
##Load libraries
require(pacman)
p_load(EpiCurve,dplyr,tidyr,pacman, ggplot2,ggthemes,broom,stringr,ggpubr,scales,lubridate)
##Required input
filename <-  args[1] #"211102.bdmm"
#Read data
metadata <- read.delim(file = (paste0(id,filename,".metadata.sanitized.clean.tsv")) , sep = '\t', header = TRUE)
metadata$date <- as.Date(metadata$date, format="%Y-%m-%d")
variants <- read.delim(file = (paste0(ref,"variants.csv")) , sep = ',', header = TRUE)
#Clean region names
metadata$division <- ifelse(grepl("Davao Region", metadata$division),'Davao', metadata$division)
metadata$division <- ifelse(grepl("Bangsamoro Autonomous Region in Muslim Mindanao", metadata$division),'BARMM', metadata$division)
metadata$division <- ifelse(grepl("Region IX", metadata$division),'Zamboanga', metadata$division)
metadata$division <- ifelse(grepl("National Capital Region", metadata$division),'NCR', metadata$division)
#Make column for VOC
metadata$voc = metadata$pangolin_lineage
metadata['voc'] = "Non VOC"
for(i in 1:nrow(variants)){
metadata$voc <- ifelse(grepl(as.character(paste0("^",variants[i,1],"$")), metadata$pangolin_lineage),as.character(variants[i,2]), metadata$voc)
}
setwd("/Users/ijborda/GitHub/gisaid-preprocessing/ncov-master")
wd = getwd()
id = paste0(wd,"/output/")
od = paste0(wd,"/output/")
ref = paste0(wd,"/reference/")
require(pacman)
p_load(EpiCurve,dplyr,tidyr,pacman, ggplot2,ggthemes,broom,stringr,ggpubr,scales,lubridate)
filename <-  "211102.bdmm"
metadata <- read.delim(file = (paste0(id,filename,".metadata.sanitized.clean.tsv")) , sep = '\t', header = TRUE)
metadata$date <- as.Date(metadata$date, format="%Y-%m-%d")
variants <- read.delim(file = (paste0(ref,"variants.csv")) , sep = ',', header = TRUE)
#Clean region names
metadata$division <- ifelse(grepl("Davao Region", metadata$division),'Davao', metadata$division)
metadata$division <- ifelse(grepl("Bangsamoro Autonomous Region in Muslim Mindanao", metadata$division),'BARMM', metadata$division)
metadata$division <- ifelse(grepl("Region IX", metadata$division),'Zamboanga', metadata$division)
metadata$division <- ifelse(grepl("National Capital Region", metadata$division),'NCR', metadata$division)
#Make column for VOC
metadata$voc = metadata$pangolin_lineage
metadata['voc'] = "Non VOC"
for(i in 1:nrow(variants)){
metadata$voc <- ifelse(grepl(as.character(paste0("^",variants[i,1],"$")), metadata$pangolin_lineage),as.character(variants[i,2]), metadata$voc)
}
View(metadata)
write.csv(x = metadata,
file = paste0(od, paste0(filename, ".met.csv")),
row.names = FALSE)
